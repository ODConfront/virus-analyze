# av-detect

杀软使用的各种病毒防御技术：
1>先易后难的介绍计算机病毒检测的例子：
简单的基于模式的病毒检测
精确识别
加密、多态和变形病毒的检测
2>扫描器的两类工作方式：
OAS - on access scan
ODS - on demand scan

1.第一代扫描器
并非所有检测技术都适用于所有病毒，也不应要求每种检测技术都能做到这一点。只要拥有一个技术仓库，其中每种技术都能有效阻止，检测或清除一种特征病毒就足够了。
1.1字符串扫描
字符串扫描是检测计算机病毒最简单的方法。从特定病毒提取特征字节序列（字符串）进行检测；非PE文件一般会做全文搜索。 
0400 B801 020E 07BB 0002 33C9 8BD1 419C
1.2通配符
通配符一般用于跳过某些字节或字节范围，甚至允许正则表达式。
0400 B801 020E 07BB ??02 %3 33C9 8BD1 419C
?? - 忽略
%3 - 接下来的3个位置(字节)尝试匹配33
反向字符串匹配（从后向前字符比较差异）、过滤算法、散列算法等使得扫描速度基本与需要匹配的字符串数目无关。
1.3不匹配字节数
允许字符串中有N个字节为任意值。
1.4通用检测法：应对变种
使用一个简单的字符串来搜索某类病毒的部分/全部已知变种，还需要执行一些特殊代码进行算法检测。当某个病毒有一种以上变种时，就可以比较这些变种以找出其
相同代码区，然后从尽可能多的变种中选出一个简单的特征字符串，一般特征字符串同时使用了“通配符”和“不匹配字节数”技术。
1.5散列
加速搜索算法的技术，对扫描的字符串的首字节或第一个16位/32位字进行计算。TbScan扫描器采用2个散列表和1个字符串表，第一个散列表包含第二个散列表的索引位。
1.6书签
书签也称检验字节(check bytes)是一种保证病毒检测和清除过程更加准确的简单方法。通常AV要计算病毒体的起始位置（常称为病毒体零字节）和特征字符串之间的
距离，并单独保存在病毒检测记录中。
好的书签可以用于具体病毒的清除。
1.7首尾扫描
只扫文件的的头部和尾部，而不扫描整个文件；比如文件开头和结尾的2KB、4KB或8KB。由于CPU的提升，扫描速度主要受I/O速度的限制。
1.8入口点和固定点扫描
二进制可执行文件，大幅降低I/O次数。
1.9超快磁盘访问
直接读取磁盘。

2.第二代扫描器
采用近似精确识别法(nearly exact identification)和精确识别法(exact identification)有助提高检测精度。 
2.1智能扫描(smart scanning)
忽略宿主中像NOP这样的指令；对处理文本格式的病毒（script和macro）也很有用，从扫描缓冲区去除多余的空白字符（如空格、回车/换行符和制表符等）；熵。
2.2骨架扫描法(skeleton scanning)
检测宏病毒，去非必要和空白字符保留宏代码骨架，从而提高检测同一家族不同变种的能力。
2.3近似精确识别法(nearly exact identification)
一种方法是采用两个字符串（而不是一个）来检测每个病毒；另一个方法是从病毒体中选出一个范围计算其效验和（如CRC32）。
2.4精确识别法(exact identification)
保证精确识别变种的唯一方法。
近似精确法仅计算病毒体中一块恒值字节区域的效验和，精确识别法则计算病毒体中全部恒值比特(bit)的效验和，必须删除病毒体中非恒值字节（变形的变量名等），
以生成一特征图张只包括所有恒值字节的特征图(map)。特征图中只能用恒值字节，因为可变数据会影响到效验和。

3.算法扫描方法




